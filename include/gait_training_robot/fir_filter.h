#ifndef FIR_FILTER_H_
#define FIR_FILTER_H_

#include <array>
/*

FIR filter designed with
 http://t-filter.appspot.com

sampling frequency: 1600 Hz

* 0 Hz - 15 Hz
  gain = 1
  desired ripple = 5 dB
  actual ripple = 4.055677259449463 dB

* 30 Hz - 800 Hz
  gain = 0
  desired attenuation = -30 dB
  actual attenuation = -30.244597471335283 dB

*/
namespace fir_filter {
  typedef float Float;


#if 0
  constexpr int SAMPLEFILTER_TAP_NUM = 107;
  constexpr std::array<Float, SAMPLEFILTER_TAP_NUM> filter_taps = {
    -0.015750481616762256,
    -0.000704237275827528,
    -0.0006773723388875135,
    -0.0006195938181753544,
    -0.00053068065878977,
    -0.0004084766602441109,
    -0.000252291696099001,
    -0.000060765020746036526,
    0.00016702335890876854,
    0.0004315789148249504,
    0.0007337945453717896,
    0.00107321891126463,
    0.0014537157856468303,
    0.0018677590720142456,
    0.0023242981536770713,
    0.0028174214093321603,
    0.0033486908862697088,
    0.003915081764178059,
    0.0045177899054851724,
    0.0051551946332340755,
    0.005825919384330895,
    0.006527746649592741,
    0.007258042062502842,
    0.008014435604035688,
    0.008793476198252484,
    0.009594786864928304,
    0.01041556761793805,
    0.011258249520768447,
    0.012100994777434395,
    0.012960931324461012,
    0.013823993638888463,
    0.014689118903884076,
    0.015552036854908025,
    0.016409220672177018,
    0.017256535040753918,
    0.018089900694365793,
    0.018905707273503866,
    0.0196995163715694,
    0.020468393972389032,
    0.021192952094939207,
    0.021931203440402475,
    0.022586917838350474,
    0.023209108979949055,
    0.023792019531994373,
    0.024332250613471395,
    0.024824653716114198,
    0.02526603202737302,
    0.02565323550863593,
    0.025983893572471627,
    0.026256533992783757,
    0.02646961612667542,
    0.026623662038339036,
    0.026714661836947862,
    0.026746403541606824,
    0.026714661836947862,
    0.026623662038339036,
    0.02646961612667542,
    0.026256533992783757,
    0.025983893572471627,
    0.02565323550863593,
    0.02526603202737302,
    0.024824653716114198,
    0.024332250613471395,
    0.023792019531994373,
    0.023209108979949055,
    0.022586917838350474,
    0.021931203440402475,
    0.021192952094939207,
    0.020468393972389032,
    0.0196995163715694,
    0.018905707273503866,
    0.018089900694365793,
    0.017256535040753918,
    0.016409220672177018,
    0.015552036854908025,
    0.014689118903884076,
    0.013823993638888463,
    0.012960931324461012,
    0.012100994777434395,
    0.011258249520768447,
    0.01041556761793805,
    0.009594786864928304,
    0.008793476198252484,
    0.008014435604035688,
    0.007258042062502842,
    0.006527746649592741,
    0.005825919384330895,
    0.0051551946332340755,
    0.0045177899054851724,
    0.003915081764178059,
    0.0033486908862697088,
    0.0028174214093321603,
    0.0023242981536770713,
    0.0018677590720142456,
    0.0014537157856468303,
    0.00107321891126463,
    0.0007337945453717896,
    0.0004315789148249504,
    0.00016702335890876854,
    -0.000060765020746036526,
    -0.000252291696099001,
    -0.0004084766602441109,
    -0.00053068065878977,
    -0.0006195938181753544,
    -0.0006773723388875135,
    -0.000704237275827528,
    -0.015750481616762256
  };
  constexpr Float group_delay = 0.0;
#elif 1
  constexpr int SAMPLEFILTER_TAP_NUM = 32;
  constexpr std::array<Float, SAMPLEFILTER_TAP_NUM> filter_taps = {
    0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 
    0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 
    0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 0.03125, 
    0.03125, 0.03125
  };
  constexpr Float group_delay = 1.0/32/2;
#endif


  class FirFilter {
  public:
    FirFilter();
    void put(Float input);
    Float get();
  private:
    Float history[SAMPLEFILTER_TAP_NUM];
    unsigned int last_index;
  };

};

#endif